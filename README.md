# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

Классы:

View -- Слой представления, чем он занимается:

- Отображает данные на странице
- Включает методы для отображения компонентов интерфейса и обработки событий взаимодействия с ними.
- классы Card, Component, Order, Form, Basket, Page, отвечают за отображение данных пользователю и взаимодействие с ним.

Model -- Слой данных, он занимается:

- Отвечает за хранение, изменение данных на сервере
- Метод получения списка товаров
- Метод получения корзины
- Метод добавления, удаления предметов из корзины
- Метод получаения полных данных о товарах
- Отправление товаров на оформление
- Включает в себя классы Model и AppState, отвечают за получение, обновление и удаление.

Presenter -- прослойка, отвечающая за связь между представлением и данными

- Включает в себя методы, обрабатывающие события элементов
- Ссылается на View и Model

## Об архитектуре.

Внутри приложения взаимодействия происходят через события. Модели инициализируют события, а слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычисления между этой передачей. Они также могут изменять значения в моделях. В общем, это механизм, который позволяет различным частям приложения обмениваться информацией и реагировать на действия пользователя.

# Базовый код

## Класс EventEmitter

EventEmitter -- обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события:

- Использует интерфейс IEvents

```
interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
```

Имеет методы:

- Метод `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - устанавливает обработчик на событие, аргументами принимает название события и колбэк
- Метод `off(eventName: EventName, callback: Subscriber)` - снимает обработчик с события, принимает название события и колбэк
- Метод `emit<T extends object>(eventName: string, data?: T)` - инициирует событие, принимает название события и объект с данными
- Метод `onAll(callback: (event: EmitterEvent) => void)` - подписывается на все события
- Метод `offAll()` - снимает все обработчики
- Метод `trigger<T extends object>(eventName: string, context?: Partial<T>)` - вызывает коллбек триггер, генерирующий событие при вызове

## Класс API

Api -- Базовый класс для взаимодействия с сервером, используется для получения и отправки данных/запросов на сервер

Конструктор:

- `baseUrl: string` — адрес сервера;
- `options: RequestInit = {}` — объект опций.

Методы:

- `get` - получает запросы с сервера;
- `post` - отправляет данные на сервер;
- `handleResponse` - обрабатывает ответы с сервера, выдавая ошибки;

## Класс Model

Управляет данными и взаимодействует с системой событий, получает тип в виде дженерика: Model<T>. Класс является абстрактным.
Конструктор:

- `data: Partial<T>` — данные;
- `events: IEvents` — объект событий.

Методы:

- `emitChanges` - инициирует событие с переданным названием и данными, уведомляя подписчиков в изменении модели;

## Класс AppState

Представляет центральная модель для управления состоянием проекта. Он содержит данные о каталоге продуктов, корзине, информации о заказе и ошибках валидации форм. Конструктор этого класса наследуется от базового класса `Model`.

Поля:

- `catalog` - Массив товаров (IProduct[]), представляющих каталог.
- `basket` - Массив товаров (IProduct[]), представляющих корзину.
- `preview` - Строка или null, используется для предпросмотра товара.
- `order` - Объект заказа (IOrder), содержащий информацию о способе оплаты, выбранных товарах, общей сумме, email, телефоне и адресе.
- `formError` - Объект ошибок формы (FormError), используется для валидации полей.

Методы:

- `setCatalog` - устанавливает список товаров;
- `setPreview` - устанавливает предпросмотр товаров и инициализирует событие об изменении;
- `getProducts` - получение корзины;
- `addToBasket` - добавление товаров в корзину;
- `removeToBasket` - удаление товара из корзины;
- `clearBasket` - очистить корзину;
- `validateAddress` - валидация полей доставки;
- `validateContacts` - валидация полей контактов;
- `getTotal` - рассчитывает итоговую стоимость товаров;
- `setItems` - массив всех id'ов корзины;
- `updateBasket` - обновление корзины;
- `setPaymentMethod` - выбор метода оплаты;
- `setOrderDeliveryField` - параметры доставки;
- `setOrderEmail` - электронная почта при оформлении;
- `setOrderPhone` - номер телефона при оформлении;
- `validateDelivery` - валидация полей способа оплаты и адреса;
- `clearOrder` - очищение всех полей;

Использует сервисный класс `LarekApi`

## Класс Component

Базовый класс, который реализует методы отрисовки пользовательского интерфейса, предоставляет инструменты для работы с DOM-элементами. Класс является абстрактным.
Конструктор:
`container: HTMLElement` - принимает элемент контейнера, в который будет помещен компонент.

Методы:

- `toggleClass` - переключает класс;
- `setImage` - устанавливает изображение с альтернативным тектом;
- `setVisible` - показывает элемент;
- `setHidden` - скрывет элемент;
- `setDisabled` - меняет статус блокировки элемеента;
- `render(data?: Partial<T>)` - выводит контейнер на страницу;

Включает в себя дженерик типа T, это специальный тип данных, который мы можем указать при создании экземпляра класса. Принимает объект с данными частичного типа T и возвращает DOM-элемент. `Component<T>` предоставляет общий функционал для работы с DOM-элементами, а его поведение зависит от переданного типа T. Это позволяет создавать гибкие и переиспользуемые компоненты

## Класс Card

Компонент карточки товара - это просто элемент, который отображает информацию о товаре. Он может содержать миниатюру (например, фотографию товара), заголовок (название товара), подзаголовок (описание или цена) и другие детали, наследуется от Component, получает тип в виде дженерика: Card<T>, содержит сеттеры и геттеры

- `set id` - устанавливает id товара;
- `set category` - устанавливает категорию товара;
- `set title` - устанавливает название товара / get title - получить название товара;
- `set image` - устанавливает изображение товара;
- `set description` - устанавливает описание товара;
- `set price` - устанавливает цену товара;
- `set button`- устанавливает текст кнопки товара;
- `set index` - установить индекс товара / get index - получить индекс товара.

Конструктор:

- `container: HTMLElement` — принимает элемент контейнера для вставки карточки;
- `actions?: ICardActions` — действия для установки на слушатели событий.

Включает в себя дженерик типа T, это специальный тип данных, который мы можем указать при создании экземпляра класса. Принимает объект с данными частичного типа T. Таким образом, класс `Card<T>` может работать с разными типами данных, что делает его более гибким и переиспользуемым.

## Класс Form

Предназначен для управления формами, наследует класс Component. Получает тип в виде дженерика: Form<T>.
Конструктор:

- `container: HTMLFormElement` — контейнер для вставки данных;
- `events: IEvents` — объект событий.

Методы:

- `onInputChange` - вызывается при изменении формы;
- `set valid` - устанавливает валидацию форм;
- `set errors` - устанавливает вывод информации об ошибке;
- `render` - выводит обновлённое состояние валидности;

## Класс Basket

Управляет отображением корзины, наследует класс Component, содержит сеттеры:

- `set item` - устанавливает элементы в корзину;
- `set total` - устанавливает общую стоимость товара.

Констурктор:

- `container: HTMLElement` — контейнер для вставки данных;
- `events: EventEmitter` — объект событий.

//

## Класс Page

Класс предназначенный для управления элементами интерфейса главной страницы, включает в себя каталог карточек товаров, счетчик товаров в корзине, блокировку прокрутки страницы. Hаследует класс Component.

- `set catalog` - выводит карточки на страницу;
- `set counter` - обновляет счетчик тотваров в корзине;
- `set locked` - блоукирует прокрутку страницы.

Конструктор:

- `container: HTMLElement` — контейнер для вставки карточек;
- `events: IEvents` — объект событий.

## Класс Modal

Отображение модального окна, наследует класс Component, отвечает за открытие, закрытие, и управление его содержимым.
Конструктор:

- `container: HTMLElement` — контейнер для вставки данных;
- `events: IEvents` — объект событий.

Методы:

- `open` - открытие модального окна;
- `close` - закрытие модального окна;
- `set` content - задает содержимое модального окна;
- `render` - отрисовывает данные и выводит их в модальном окне;

## Класс OrderForm

Отвечает за оформление заказа, выбор способа оплаты, указание адреса, наследует класс `Form`.

Конструктор:

- `container: HTMLElement` — контейнер для вставки данных;
- `events: IEvents` — объект событий.

Методы:

- `setToggleClassPayment` - Метод используется для переключения класса активности кнопок в зависимости от переданного имени.
- `set address` - метод устанавливает значение адреса.

## Класс Contacts

Отвечает за поля почты и телефона, наследует класс `Form`.

Конструктор:

- `container: HTMLElement` — контейнер для вставки данных;
- `events: IEvents` — объект событий.

Методы:

- `set email` - Метод используется для установки значения почты
- `set phone` - Метод используется для установки значения телефона

## Класс Success

Класс используется для вывода окончательных данных покупки, вывода элементов закрытия модального окна.

Конструктор:

- `container: HTMLElement` — контейнер для вставки данных;
- `actions: ISuccessActions` — Событие успешного завершения операции.

Методы:

- `set total` - Метод для вывода окончательной суммы покупки

# Типы данных

type TProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил' ;
type TPayment = 'онлайн' | 'при получении' ;

//данные карточек товара
interface IProduct {
id: string;
category: TProductCategory;
title: string;
description: string;
price: number;
image?: string;
}

//данные заказа
interface IProductOrder {
item: IProduct;
total: number;
}

//данные формы оплаты и контактов
interface IOrderForm {
payment: TPayment;
address: string;
email: string;
phone: string;
}

//данные корзины
interface IBasket {
item: IProduct;
price: number;
total: number;
}

//данные успешного заказа
interface IOrderSuccess {
id: string;
total: number;
}

//все данные компонентов приложения
interface IAppState {
catalog: IProduct[];
basket: string [];
preview: string | null;
order: IOrderForm | null;
}

## Основные события в приложении

- `events.on<CatalogChangeEvent>` - отображение товаров
- `events.on('card:select', (item: Product))` - превью товара
- `events.on('card:select', (item: Product))` - изменен открытый выбранный товар
- `events.on('basket:open', ())` - открытие корзины
- `events.on('basket:changed', ())` - изменения в корзине
- `events.on('add:product', (item: IProduct))` - добавление элемента в корзину
- `events.on('card:delete', (item: IProduct))` - удаление товара из корзины
- `events.on('order:open', ())` - нажимаем на кнопку оформить
- `events.on('order.payment:change', (data: { target: string }))` - Переключение способов оплаты в доставке
- `events.on('order.address:change', (data: { value: string }))` - Изменение поля доставки
- `events.on('deliveryFormError:change', (errors: Partial<IOrderDelivery>))` - Валидация полей доставки
- `events.on('order:submit', ())` - нажимаем на кнопку далее
- `events.on('contacts.email:change', (data: { value: string }))` - изменение поля email
- `events.on('contacts.phone:change', (data: { value: string }))` - изменение поля phone
- `events.on('contactsFormError:change', (errors: Partial<IOrderContact>))` - Валидация полей контактов
- `events.on('contacts:submit', ())` - нажимаем на кнопку оплатить, открывается модальное окно 'заказ оформлен'
